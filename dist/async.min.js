/* async 2022-05-26 10:53:44 */
var asyncWorker=function(){function n(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}let c={},r=[];function s(e,r){let t,s,l=[];if("object"==typeof e)if(t=e.uuid,s=e.chainUuid,"[object Array]"===Object.prototype.toString.call(s))for(let e=0;e<s.length;e++)l.push(c[t].promiseObj[s[e]]);else l.push(c[t].promiseObj[s]);else t=e;let o,i,u=new Promise(function(e,r){o=e,i=r});return 0<l.length&&(u=Promise.allSettled(l).then(e=>u)),r&&(u=u.then(r)),e=n(),c[t].promiseUuid.push(e),c[t].promises.push(u),c[t].resolves.push(o),c[t].rejectes.push(i),c[t].promiseObj[e]=u,c[t].resolveObj[e]=o,c[t].rejectObj[e]=i,e}function t(e,t){if(c[e])for(let r=0;r<c[uuid1].resolves.length;r++)if(null!=c[uuid1].resolves[r]){let e=c[uuid1].resolves[r];c[uuid1].rejectes[r];c[uuid1].resolves[r]=null,c[uuid1].rejectes[r]=null,e(t)}}asyncWorker.join("49a16e73-6f72-48e2-935a-5c7129fdf8af").then(e=>{e.forEach(e=>{console.log(e)})});function l(e){return c[e]?(e=c[e].promises,Promise.allSettled(e).then(e=>{let r=[];return e.forEach(e=>{"fulfilled"===e.status?r.push(e.value):r.push(e.reason)}),r})):Promise.resolve()}return{create:function(){var e=n();return c[e]={promiseUuid:[],promises:[],resolves:[],rejectes:[],promiseObj:{},resolveObj:{},rejectObj:{}},r.push(e),e},resolve:function(e,s){let l,o;if(o="object"==typeof e?(l=e.uuid,e.promiseUuid):void(l=e),c[l]){let r,t;if(void 0===o){for(let e=0;e<c[l].resolves.length;e++)if(null!=c[l].resolves[e]){r=c[l].resolves[e],t=c[l].rejectes[e],c[l].resolves[e]=null,c[l].rejectes[e]=null,o=c[l].promiseUuid[e];break}}else{r=c[l].resolveObj[o],t=c[l].rejectObj[o];e=c[l].resolves.indexOf(r);c[l].resolves[e]=null,e=c[l].rejectes.indexOf(t),c[l].rejectes[e]=null}r&&r(s)}return o},reject:function(e,s){let l,o;if(o="object"==typeof e?(l=e.uuid,e.promiseUuid):void(l=e),c[l]){let r,t;if(void 0===o){for(let e=0;e<c[l].resolves.length;e++)if(null!=c[l].resolves[e]){r=c[l].resolves[e],t=c[l].rejectes[e],c[l].resolves[e]=null,c[l].rejectes[e]=null,o=c[l].promiseUuid[e];break}}else{r=c[l].resolveObj[o],t=c[l].rejectObj[o];e=c[l].resolves.indexOf(r);c[l].resolves[e]=null,e=c[l].rejectes.indexOf(t),c[l].rejectes[e]=null}t&&t(s)}return o},resolveAll:t,rejectAll:function(e,t){if(c[e])for(let r=0;r<c[uuid1].resolves.length;r++)if(null!=c[uuid1].resolves[r]){c[uuid1].resolves[r];let e=c[uuid1].rejectes[r];c[uuid1].resolves[r]=null,c[uuid1].rejectes[r]=null,e(t)}},join:l,stop:function(e){return t(e),l(e)},destroy:function(e){t(e),delete c[e];e=r.indexOf(e);-1!==e&&r.splice(e,1)},getPromise:function(e,r){if(c[e]&&void 0!==r)return c[e].promiseObj[r]},addPromise:s,addSerialPromise:function(e,r){var t=c[e].promiseUuid[c[e].promiseUuid.length-1];return s({uuid:e,chainUuid:t},r)},getWorkerId:function(){return r},getPromiseId:function(e){return c[e]?c[e].promiseUuid:[]},getStatus:function(e){const s={};if(c[e]){let t=Promise.allSettled(c[e].promises);return new Promise(function(r,e){setTimeout(()=>{console.log("[asyncWorker.getStatus]",t),Promise.race([t,s]).then(e=>{r(e===s?"pending":"fulfilled")},()=>{r("rejected")})},1)})}return Promise.resolve("fulfilled")},getDetailedStatus:function(e){const o={};if(c[e]){let t={detail:{}},s=Promise.allSettled(c[e].promises),l=[];for(let r in c[e].promiseObj)l.push(Promise.race([c[e].promiseObj[r],o]).then(e=>t.detail[r]=e===o?"pending":"fulfilled",()=>t.detail[r]="rejected"));return new Promise(function(r,e){setTimeout(()=>{console.log("[asyncWorker.getStatus]",s),Promise.allSettled(l).then(()=>Promise.race([s,o]).then(e=>{t.status=e===o?"pending":"fulfilled",r(t)},()=>{t.status="rejected",r(t)}))},1)})}return Promise.resolve({status:"fulfilled",detail:{}})}}}();
//# sourceMappingURL=async.min.js.map