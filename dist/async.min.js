/* async 2022-05-28 12:39:25 */
var asyncWorker=function(){function n(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}let d={},r=[];function s(e,r){let t,s,l=[];if("object"==typeof e)if(t=e.uuid,s=e.chainUuid,"[object Array]"===Object.prototype.toString.call(s))for(let e=0;e<s.length;e++)l.push(d[t].promiseObj[s[e]]);else l.push(d[t].promiseObj[s]);else t=e;let i,o,u=new Promise(function(e,r){i=e,o=r});return 0<l.length&&(u=Promise.allSettled(l).then(e=>u)),r&&(u=u.then(r)),e=n(),d[t].promiseUuid.push(e),d[t].promises.push(u),d[t].resolves.push(i),d[t].rejectes.push(o),d[t].promiseObj[e]=u,d[t].resolveObj[e]=i,d[t].rejectObj[e]=o,e}function t(e,t){if(d[e])for(let r=0;r<d[uuid1].resolves.length;r++)if(null!=d[uuid1].resolves[r]){let e=d[uuid1].resolves[r];d[uuid1].rejectes[r];d[uuid1].resolves[r]=null,d[uuid1].rejectes[r]=null,e(t)}}function l(e){return d[e]?(e=d[e].promises,Promise.allSettled(e).then(e=>{let r=[];return e.forEach(e=>{"fulfilled"===e.status?r.push(e.value):r.push(e.reason)}),r})):Promise.resolve()}return{create:function(){var e=n();return d[e]={promiseUuid:[],promises:[],resolves:[],rejectes:[],promiseObj:{},resolveObj:{},rejectObj:{}},r.push(e),e},resolve:function(e,s){let l,i;if(i="object"==typeof e?(l=e.uuid,e.promiseUuid):void(l=e),d[l]){let r,t;if(void 0===i){for(let e=0;e<d[l].resolves.length;e++)if(null!=d[l].resolves[e]){r=d[l].resolves[e],t=d[l].rejectes[e],d[l].resolves[e]=null,d[l].rejectes[e]=null,i=d[l].promiseUuid[e];break}}else{r=d[l].resolveObj[i],t=d[l].rejectObj[i];e=d[l].resolves.indexOf(r);d[l].resolves[e]=null,e=d[l].rejectes.indexOf(t),d[l].rejectes[e]=null}r&&r(s)}return i},reject:function(e,s){let l,i;if(i="object"==typeof e?(l=e.uuid,e.promiseUuid):void(l=e),d[l]){let r,t;if(void 0===i){for(let e=0;e<d[l].resolves.length;e++)if(null!=d[l].resolves[e]){r=d[l].resolves[e],t=d[l].rejectes[e],d[l].resolves[e]=null,d[l].rejectes[e]=null,i=d[l].promiseUuid[e];break}}else{r=d[l].resolveObj[i],t=d[l].rejectObj[i];e=d[l].resolves.indexOf(r);d[l].resolves[e]=null,e=d[l].rejectes.indexOf(t),d[l].rejectes[e]=null}t&&t(s)}return i},resolveAll:t,rejectAll:function(e,t){if(d[e])for(let r=0;r<d[uuid1].resolves.length;r++)if(null!=d[uuid1].resolves[r]){d[uuid1].resolves[r];let e=d[uuid1].rejectes[r];d[uuid1].resolves[r]=null,d[uuid1].rejectes[r]=null,e(t)}},join:l,stop:function(e){return t(e),l(e)},destroy:function(e){t(e),delete d[e];e=r.indexOf(e);-1!==e&&r.splice(e,1)},getPromise:function(e,r){if(d[e]&&void 0!==r)return d[e].promiseObj[r]},addPromise:s,addSerialPromise:function(e,r){var t=d[e].promiseUuid[d[e].promiseUuid.length-1];return s({uuid:e,chainUuid:t},r)},getWorkerId:function(){return r},getPromiseId:function(e){return d[e]?d[e].promiseUuid:[]},getStatus:function(e){const s={};if(d[e]){let t=Promise.allSettled(d[e].promises);return new Promise(function(r,e){setTimeout(()=>{console.log("[asyncWorker.getStatus]",t),Promise.race([t,s]).then(e=>{r(e===s?"pending":"fulfilled")},()=>{r("rejected")})},1)})}return Promise.resolve("fulfilled")},getDetailedStatus:function(e){const i={};if(d[e]){let t={detail:{}},s=Promise.allSettled(d[e].promises),l=[];for(let r in d[e].promiseObj)l.push(Promise.race([d[e].promiseObj[r],i]).then(e=>t.detail[r]=e===i?"pending":"fulfilled",()=>t.detail[r]="rejected"));return new Promise(function(r,e){setTimeout(()=>{console.log("[asyncWorker.getStatus]",s),Promise.allSettled(l).then(()=>Promise.race([s,i]).then(e=>{t.status=e===i?"pending":"fulfilled",r(t)},()=>{t.status="rejected",r(t)}))},1)})}return Promise.resolve({status:"fulfilled",detail:{}})}}}();
//# sourceMappingURL=async.min.js.map